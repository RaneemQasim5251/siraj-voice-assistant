# ๐ง ุฅุตูุงุญ ูุดุงูู ุงูุชุฒุงูู ูู Gemini Live API

## ๐จ ุงููุดุงูู ุงูุฃุณุงุณูุฉ

### 1. **Audio Queue Overflow** - ุชุฑุงูู ุงูุจูุงูุงุช ุงูุตูุชูุฉ
```python
# ุงููุดููุฉ ุงูุฃุตููุฉ:
self.audio_queue = deque()  # ุจุฏูู ุญุฏ ุฃูุตู
```

**ุงูุฃุนุฑุงุถ:**
- ุชููู Gemini ุฃุซูุงุก ุงูููุงู
- ุชูุฑุงุฑ ุงููููุงุช ุฃู ุงูุฌูู
- ุชุฃุฎูุฑ ูุชุฒุงูุฏ ูู ุงูุงุณุชุฌุงุจุฉ

**ุงูุญู:**
```python
# ุงูุญู ุงููุทุจู:
self.audio_queue = deque(maxlen=10)  # ุญุฏ ุฃูุตู ููุฐุงูุฑุฉ
# + ููุน ุชุฑุงูู ุงูุจูุงูุงุช ุงูุตูุชูุฉ ุงููุฏููุฉ
```

### 2. **Threading Race Conditions** - ุชุถุงุฑุจ ุงูุฎููุท
```python
# ุงููุดููุฉ:
# ุนุฏุฉ ุฎููุท ุชุนูู ุนูู ููุณ ุงูุจูุงูุงุช ุจุฏูู ุชุฒุงูู
```

**ุงูุญู:**
```python
# ุฅุถุงูุฉ Locks ููุชุฒุงูู:
self.playback_lock = asyncio.Lock()
self.cleanup_lock = asyncio.Lock()
self.recovery_lock = asyncio.Lock()
```

### 3. **Memory Leaks** - ุชุณุฑูุจ ุงูุฐุงูุฑุฉ
```python
# ุงููุดููุฉ:
# ุนุฏู ุชูุธูู ูููุงุช ุงูุตูุช ุงููุคูุชุฉ
```

**ุงูุญู:**
```python
# ุชูุธูู ูุญุณู:
finally:
    try:
        os.unlink(tmp_file.name)
    except:
        pass
```

## ๐๏ธ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. **Enhanced AudioManager**
```python
class AudioManager:
    def __init__(self):
        # ุญุฏ ุฃูุตู ูุทุงุจูุฑ ุงูุตูุช
        self.audio_queue = deque(maxlen=10)
        
        # ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก
        self.audio_errors = 0
        self.max_audio_errors = 5
        
        # Locks ููุชุฒุงูู
        self.playback_lock = asyncio.Lock()
        self.cleanup_lock = asyncio.Lock()
```

**ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:**
- โ ููุน ุชุฑุงูู ุงูุจูุงูุงุช ุงูุตูุชูุฉ
- โ ุฅุนุงุฏุฉ ุถุจุท ุชููุงุฆูุฉ ุนูุฏ ุงูุฃุฎุทุงุก
- โ ุชูุธูู ูุญุณู ููููุงุฑุฏ
- โ ูุฑุงูุจุฉ timeout ููุตูุช

### 2. **Session Recovery System**
```python
class GeminiLiveSession:
    async def _recover_session(self):
        """ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุณุฉ ุนูุฏ ุงูุฃุฎุทุงุก"""
        # ุฅููุงู ุงูุฌูุณุฉ ุงูุญุงููุฉ
        # ุงูุชุธุงุฑ ูุตูุฑ
        # ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ
        # ุฅุนุงุฏุฉ ุชุนููู ุงููุฑุงูุจุงุช
```

**ุงููููุฒุงุช:**
- โ ูุฑุงูุจุฉ timeout ููุงุณุชุฌุงุจุฉ
- โ ping ุฏูุฑู ููุงุชุตุงู
- โ ุฅุนุงุฏุฉ ุชุดุบูู ุชููุงุฆูุฉ
- โ ูุฑุงูุจุฉ ุตุญุฉ ุงูุงุชุตุงู

### 3. **Error Handling ุงููุญุณู**
```python
# ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก ุงูุชุฑุงูููุฉ
consecutive_errors = 0
max_consecutive_errors = 10

if consecutive_errors >= max_consecutive_errors:
    logger.error("โ Too many errors - triggering recovery")
    self.connection_healthy = False
```

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุดุบูู ุงููุณุฎุฉ ุงููุญุณูุฉ
```bash
python3 full_inegration.py
```

### 2. ูุฑุงูุจุฉ ุงูููุฌ
```bash
# ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู:
โ Enhanced audio streams initialized
๐ก Session ping sent
๐ Starting session recovery
โ Session recovery successful
```

### 3. ุงุฎุชุจุงุฑ ุงูุซุจุงุช
- ุชุญุฏุซ ููุฏุฉ 10-15 ุฏูููุฉ ูุชูุงุตูุฉ
- ุฌุฑุจ ููุงุทุนุฉ Gemini ุฃุซูุงุก ุงูููุงู
- ุงุฎุชุจุฑ ุฒุฑ "ุฅุนุงุฏุฉ ุชุดุบูู" ุนูุฏ ุงููุดุงูู

## ๐ ุชุญุณููุงุช ุงูุฃุฏุงุก

### Buffer Management
```python
# ุชุญุณูู ุฃุญุฌุงู ุงูุจููุฑ:
self.CHUNK_SIZE = 512  # ุฃุตุบุฑ ููุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ
frames_per_buffer=self.CHUNK_SIZE * 2  # ุฃูุจุฑ ููุฅุฎุฑุงุฌ
```

### Exponential Backoff
```python
# ุชุฃุฎูุฑ ูุชุฒุงูุฏ ุนูุฏ ุงูุฃุฎุทุงุก:
await asyncio.sleep(0.1 * consecutive_errors)
```

### Queue Management
```python
# ููุน ุงูุชูุงุก ุงูุทุงุจูุฑ:
if len(self.audio_queue) >= self.audio_queue.maxlen - 1:
    logger.warning("๐จ Audio queue near capacity")
    while len(self.audio_queue) > 3:
        self.audio_queue.popleft()
```

## ๐ ูุฑุงูุจุฉ ุงููุดุงูู

### ุนูุงูุงุช ุงููุดุงูู:
```
โ Audio queue overflow
โ๏ธ Session timeout detected
๐จ Too many consecutive errors
โ Audio stream inactive
```

### ุนูุงูุงุช ุงูุตุญุฉ:
```
โ Enhanced audio streams initialized
๐ก Session ping sent
โ Session recovery successful
โ Audio cleanup completed
```

## ๐ก๏ธ ุงูููุงูุฉ ูู ุงููุดุงูู

### 1. ูุฑุงูุจุฉ ุฏูุฑูุฉ
- ูุญุต ุตุญุฉ ุงูุงุชุตุงู ูู 5 ุซูุงูู
- ping ููุฌูุณุฉ ูู 30 ุซุงููุฉ
- timeout ููุงุณุชุฌุงุจุฉ 60 ุซุงููุฉ

### 2. ุชูุธูู ุชููุงุฆู
- ุชูุธูู ุทุงุจูุฑ ุงูุตูุช ุนูุฏ ุงูุงูุชูุงุก
- ุฅุฒุงูุฉ ูููุงุช ุงูุตูุช ุงููุคูุชุฉ
- ุฅุนุงุฏุฉ ุถุจุท ุงูุนุฏุงุฏุงุช ุนูุฏ ุงููุฌุงุญ

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุฐููุฉ
- retry ูุน exponential backoff
- ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุณุฉ ุนูุฏ ุงูุฃุฎุทุงุก ุงููุชูุฑุฑุฉ
- ุญูุธ ุญุงูุฉ ุงููุญุงุฏุซุฉ

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุงูุชุทุจูู:
- โ ุงุณุชูุฑุงุฑ ุฃูุถู ูููุญุงุฏุซุงุช ุงูุทูููุฉ
- โ ุชูููู ุงูุชููู ุฃุซูุงุก ุงูููุงู
- โ ุฅุนุงุฏุฉ ุชุดุบูู ุชููุงุฆูุฉ ุนูุฏ ุงููุดุงูู
- โ ุงุณุชุฎุฏุงู ุฃูุซู ููุฐุงูุฑุฉ
- โ ุงุณุชุฌุงุจุฉ ุฃุณุฑุน ููููุงุทุนุงุช

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: ูุง ูุฒุงู ูุชููู
```bash
# ุชุญูู ูู:
1. ุญุฌู chunk_size (ุฌุฑุจ 256 ุจุฏูุงู ูู 512)
2. ุญุฏ ุทุงุจูุฑ ุงูุตูุช (ุฌุฑุจ 5 ุจุฏูุงู ูู 10)
3. timeout values (ููููุง ุฅูู 30 ุซุงููุฉ)
```

### ูุดููุฉ: ุฌูุฏุฉ ุตูุช ุถุนููุฉ
```bash
# ุฒูุงุฏุฉ buffer sizes:
frames_per_buffer=self.CHUNK_SIZE * 4
```

### ูุดููุฉ: ุจุทุก ูู ุงูุงุณุชุฌุงุจุฉ
```bash
# ุชูููู ping interval:
self.ping_interval = 15  # ุจุฏูุงู ูู 30
``` 